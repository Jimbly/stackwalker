{"version":3,"sources":["node_modules/browser-pack/_prelude.js","dist/game/build.intermediate/client/client/app.js","dist/game/build.intermediate/client/glov/client/glov/bootstrap.js","dist/game/build.intermediate/client/glov/client/glov/local_storage.js","dist/game/build.intermediate/client/glov/client/glov/polyfill.js","dist/game/build.intermediate/client/client/main.js"],"names":[],"mappings":"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","file":"app.bundle.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","/* eslint global-require:off */\n\n// Startup code.\n\nlet called_once = false;\nwindow.onload = function () {\n  if (called_once) {\n    return;\n  }\n  called_once = true;\n  // require('./glov/worker_comm.js').startup(); // First, so it gets loading quickly (if workers required)\n  require('./glov/bootstrap.js');\n  require('./main.js').main();\n};\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n\n// Things that should be done before requiring or running any user-level code or other engine code\n\nrequire('./polyfill.js');\n\nlet debug = document.getElementById('debug');\nwindow.onerror = function (e, file, line, col, errorobj) {\n  let msg = `${e}\\n  at ${file}(${line}:${col})`;\n  if (errorobj && errorobj.stack) {\n    msg = `${errorobj.stack}`;\n    if (errorobj.message) {\n      if (msg.indexOf(errorobj.message) === -1) {\n        msg = `${errorobj.message}\\n${msg}`;\n      }\n    }\n    let origin = document.location.origin || '';\n    if (origin) {\n      if (origin.slice(-1) !== '/') {\n        origin += '/';\n      }\n      msg = msg.split(origin).join(''); // replace\n    }\n    // fixup weird Firefox weirdness\n    msg = msg.replace(/\\[\\d+\\]</g, '') // remove funny [123] at start of stack lines\n      .replace(/<?\\/<?/g, '/') // remove funny <s, they mess up people's copy and paste\n      .replace(/\\n([^ ])/g, '\\n  $1'); // add indentation if missing\n  }\n  let show = true;\n  if (window.glov_error_report) {\n    show = window.glov_error_report(msg, file, line, col);\n  }\n  if (show) {\n    debug.innerText = `${msg}\\n\\nPlease report this error to the developer, and then reload this page.`;\n  }\n};\nwindow.debugmsg = function (msg, clear) {\n  if (clear) {\n    debug.innerText = msg;\n  } else {\n    debug.innerText += `${msg}\\n`;\n  }\n};\n","// Portions Copyright 2019 Jimb Esser (https://github.com/Jimbly/)\n// Released under MIT License: https://opensource.org/licenses/MIT\n/* eslint-env browser */\n\nexports.storage_prefix = 'demo';\n\nlet lsd = (function () {\n  try {\n    localStorage.test = 'test';\n    return localStorage;\n  } catch (e) {\n    return {};\n  }\n}());\nexport function get(key) {\n  key = `${exports.storage_prefix}_${key}`;\n  let ret = lsd[key];\n  if (ret === 'undefined') {\n    ret = undefined;\n  }\n  return ret;\n}\n\nexport function set(key, value) {\n  key = `${exports.storage_prefix}_${key}`;\n  if (value === undefined || value === null) {\n    delete lsd[key];\n  } else {\n    lsd[key] = value;\n  }\n}\n\nexport function setJSON(key, value) {\n  set(key, JSON.stringify(value));\n}\n\nexport function getJSON(key, def) {\n  let value = get(key);\n  if (value === undefined) {\n    return def;\n  }\n  try {\n    return JSON.parse(value);\n  } catch (e) {\n    // ignore\n  }\n  return def;\n}\n\nexport function clearAll(key_prefix) {\n  let prefix = new RegExp(`^${exports.storage_prefix}_${key_prefix || ''}`, 'u');\n  for (let key in lsd) {\n    if (key.match(prefix)) {\n      delete lsd[key];\n    }\n  }\n}\n\nexport function exportAll() {\n  let obj = {};\n  let prefix = new RegExp(`^${exports.storage_prefix}_(.*)`, 'u');\n  for (let key in lsd) {\n    let m = key.match(prefix);\n    if (m) {\n      let v = lsd[key];\n      if (v && v !== 'undefined') {\n        obj[m[1]] = v;\n      }\n    }\n  }\n  return JSON.stringify(obj);\n}\n\nexport function importAll(serialized) {\n  let obj = JSON.parse(serialized);\n  clearAll();\n  for (let key in obj) {\n    set(key, obj[key]);\n  }\n}\n","/* eslint no-extend-native:off,no-invalid-this:off */\n\n// TypedArray.slice, fill, join, sort, etc - not supported on IE, some older Safari, older Android\nlet typedarrays = [Int8Array, Uint8Array, Int16Array, Uint16Array, Int32Array, Uint32Array, Float32Array];\n\nif (!Uint8Array.prototype.slice) {\n  typedarrays.forEach(function (ArrayType) {\n    Object.defineProperty(ArrayType.prototype, 'slice', {\n      value: function (begin, end) {\n        if (end === undefined) {\n          end = this.length;\n        }\n        if (end < 0) {\n          end = this.length - end;\n        }\n        begin = begin || 0;\n        if (begin >= this.length) {\n          begin = this.length - 1;\n        }\n        if (end > this.length) {\n          end = this.length;\n        }\n        if (end < begin) {\n          end = begin;\n        }\n        let len = end - begin;\n        let ret = new ArrayType(len);\n        for (let ii = begin; ii < end; ++ii) {\n          ret[ii] = this[ii];\n        }\n        return ret;\n      }\n    });\n  });\n}\n\nfunction cmpDefault(a, b) {\n  return a - b;\n}\nlet replacements = {\n  join: function (delim) {\n    return Array.prototype.join.call(this, delim);\n  },\n  fill: function (value, begin, end) {\n    if (end === undefined) {\n      end = this.length;\n    }\n    for (let ii = begin || 0; ii < end; ++ii) {\n      this[ii] = value;\n    }\n    return this;\n  },\n  sort: function (cmp) {\n    Array.prototype.sort.call(this, cmp || cmpDefault);\n  },\n};\n\nfor (let key in replacements) {\n  if (!Uint8Array.prototype[key]) {\n    typedarrays.forEach(function (ArrayType) {\n      Object.defineProperty(ArrayType.prototype, key, {\n        value: replacements[key],\n      });\n    });\n  }\n}\n\nif (!String.prototype.endsWith) {\n  Object.defineProperty(String.prototype, 'endsWith', {\n    value: function (test) {\n      return this.slice(-test.length) === test;\n    },\n  });\n  Object.defineProperty(String.prototype, 'startsWith', {\n    value: function (test) {\n      return this.slice(0, test.length) === test;\n    },\n  });\n}\n","/* eslint no-useless-catch:off */\nconst local_storage = require('./glov/local_storage.js');\nlocal_storage.storage_prefix = 'stackwalker';\n\nconst querystring = require('query-string');\nconst stack_mapper = require('stack-mapper');\n\nlet error_report_regex = /^([^ ]+) \\[([^\\]]+)] \"POST ([^\"?]+)?([^\"]+)\" START \"([^\"]+)\" \"([^\"]+)\"$/;\nlet fileline_regex1 = /(.)([^(/:]+)\\((\\d+):(\\d+)\\)$/;\nlet fileline_regex2 = /(?:at ([^(]+) \\(.*\\/)?([^(/:]+):(\\d+)(?::(\\d+))?\\)$/;\n\nfunction prettyFileLine(a) {\n  return `${a.fn || ''} (${a.filename}:${a.line}:${a.column})`;\n}\n\nfunction preparse(text) {\n  let lines = text.split('\\n');\n  let ret = [];\n  for (let ii = 0; ii < lines.length; ++ii) {\n    let line = lines[ii];\n    let m = line.match(error_report_regex);\n    if (!m) {\n      ret.push(line);\n      continue;\n    }\n    // let ip = m[1];\n    // let timestamp = m[2];\n    // let url_start = m[3];\n    let search = m[4];\n    // let referrer = m[5];\n    let useragent = m[6];\n    let query = querystring.parse(search);\n    // Source URL line\n    if (query.url) {\n      ret.push('');\n      ret.push(`User URL=${query.url}, UA=${useragent}`);\n    }\n    // Header line\n    let header = [];\n    if (query.cidx && query.cidx !== '1') {\n      header.push(`CIDX=${query.cidx}`);\n    }\n    if (query.ver) {\n      header.push(`ver=${query.ver}`);\n    }\n    if (header.length) {\n      ret.push(header.join(', '));\n    }\n    if (query.file) {\n      ret.push(prettyFileLine({\n        filename: query.file.match(/[^/]+$/)[0],\n        line: query.line,\n        column: query.col,\n      }));\n    }\n    ret = ret.concat(query.msg.split('\\n'));\n  }\n  return ret.join('\\n');\n}\n\nfunction parseStack(text) {\n  text = preparse(text);\n  let lines = text.split('\\n');\n  lines = lines.map((line) => {\n    let m = line.match(fileline_regex1) || line.match(fileline_regex2);\n    if (m) {\n      return {\n        fn: m[1],\n        filename: m[2],\n        line: m[3],\n        column: m[4] ? Number(m[4]) - 1 : undefined, // the - 1 seems to help in some cases\n        tooltip: line,\n      };\n    }\n    return { err: line, tooltip: line };\n  });\n  return lines;\n}\n\nexport function main() {\n  let upload = document.getElementById('upload');\n  let upload_status = document.getElementById('upload_status');\n  let stack = document.getElementById('stack');\n  let frames_bundle = document.getElementById('frames_bundle');\n  let frames_source = document.getElementById('frames_source');\n  let sourcecode = document.getElementById('sourcecode');\n  let source_pre = document.getElementById('source_pre');\n  let source_line = document.getElementById('source_line');\n  let source_post = document.getElementById('source_post');\n\n  let stack_data;\n  let sourcemap_data;\n  let stackmapper;\n\n  function toOptions(list) {\n    return list.map((a) => {\n      let str = a.err !== undefined ? a.err : prettyFileLine(a);\n      return `<option${a.err ? ' disabled' : ''}` +\n        `${a.tooltip?` title=\"${a.tooltip.replace(/\"/g, '&quot;')}\"`:''}` +\n        `>${str}</option>`;\n    }).join('\\n');\n  }\n\n  let mapped_stack;\n\n  function update() {\n    // window.debugmsg('', true);\n    let stack_frames = parseStack(stack_data);\n    frames_bundle.innerHTML = toOptions(stack_frames);\n\n    mapped_stack = null;\n    if (!stackmapper) {\n      frames_source.innerHTML = toOptions([{ err: 'Missing sourcemap' }]);\n      return;\n    }\n    let line_mapping = {};\n    let to_process = [];\n    for (let ii = 0; ii < stack_frames.length; ++ii) {\n      let elem = stack_frames[ii];\n      if (elem.filename) {\n        line_mapping[ii] = to_process.length;\n        to_process.push(elem);\n      }\n    }\n    let out = stackmapper.map(to_process);\n    let out_lines = [];\n    mapped_stack = [];\n    for (let ii = 0; ii < stack_frames.length; ++ii) {\n      if (line_mapping[ii] === undefined) {\n        mapped_stack.push(null);\n        out_lines.push({ err: '' });\n      } else {\n        mapped_stack.push(out[line_mapping[ii]]);\n        out_lines.push(out[line_mapping[ii]]);\n      }\n    }\n    frames_source.innerHTML = toOptions(out_lines);\n  }\n\n  function updateFocus() {\n    let idx = frames_bundle.selectedIndex;\n    let lineinfo = mapped_stack && mapped_stack[idx];\n    if (!sourcemap_data) {\n      source_pre.textContent = 'No sourcemap loaded';\n      source_line.textContent = source_post.textContent = '';\n      return;\n    }\n    if (!lineinfo) {\n      source_pre.textContent = 'No source selected';\n      source_line.textContent = source_post.textContent = '';\n      return;\n    }\n    let { sources, sourcesContent } = sourcemap_data;\n    let { filename, line } = lineinfo;\n    let found = -1;\n    for (let ii = 0; ii < sources.length; ++ii) {\n      if (sources[ii].endsWith(filename)) {\n        found = ii;\n      }\n    }\n    if (found === -1 || !sourcesContent[found]) {\n      source_pre.textContent = `Could not find ${filename} in sourcemap.sources`;\n      source_line.textContent = source_post.textContent = '';\n      return;\n    }\n    let lines = sourcesContent[found].split('\\n');\n    source_pre.textContent = lines.slice(0, line - 1).join('\\n');\n    source_line.textContent = lines[line - 1];\n    source_post.textContent = lines.slice(line, lines.length).join('\\n');\n    source_line.scrollIntoView(true);\n    let st = sourcecode.scrollTop;\n    source_line.scrollIntoView(false);\n    st += sourcecode.scrollTop;\n    sourcecode.scrollTop = Math.round(st / 2);\n  }\n\n  upload.addEventListener('change', (ev) => {\n    let file_to_load = upload.files[0];\n    let reader = new FileReader();\n    local_storage.set('sourcemap', undefined);\n    sourcemap_data = null;\n    stackmapper = null;\n    reader.onload = (loaded_event) => {\n      let text = loaded_event.target.result;\n      try {\n        sourcemap_data = JSON.parse(text);\n      } catch (e) {\n        upload_status.textContent = 'Status: Error parsing Sourcemap';\n        throw e;\n      }\n      if (sourcemap_data && sourcemap_data.version === 3) {\n        upload_status.textContent = 'Status: Sourcemap loaded';\n        stackmapper = stack_mapper(sourcemap_data);\n        //local_storage.setJSON('sourcemap', sourcemap_data);\n      } else {\n        upload_status.textContent = 'Status: Error parsing Sourcemap (expected version: 3)';\n      }\n      update();\n    };\n\n    reader.readAsText(file_to_load, 'UTF-8');\n  });\n\n  function onStackChange(ev) {\n    stack_data = ev.target.value;\n    local_storage.set('stack', stack_data);\n    update();\n  }\n  stack.addEventListener('change', onStackChange);\n  stack.addEventListener('input', onStackChange);\n  stack.value = stack_data = local_storage.get('stack') || '';\n\n  function onFramesChange(ev) {\n    let idx = ev.target.selectedIndex;\n    if (frames_bundle.selectedIndex !== idx) {\n      frames_bundle.selectedIndex = idx;\n    }\n    if (frames_source.selectedIndex !== idx) {\n      frames_source.selectedIndex = idx;\n    }\n    updateFocus();\n  }\n  frames_bundle.addEventListener('change', onFramesChange);\n  //frames_bundle.addEventListener('input', onFramesChange);\n  frames_source.addEventListener('change', onFramesChange);\n  //frames_source.addEventListener('input', onFramesChange);\n\n  //sourcemap_data = local_storage.getJSON('sourcemap');\n  if (sourcemap_data && sourcemap_data.version === 3) {\n    upload_status.textContent = 'Status: Sourcemap loaded from local storage';\n  }\n\n  // Sync scroll areas\n  let scroll_locked_source = 0;\n  let scroll_locked_bundle = 0;\n  frames_source.addEventListener('scroll', () => {\n    if (Date.now() < scroll_locked_source) {\n      return;\n    }\n    scroll_locked_bundle = Date.now() + 400;\n    frames_bundle.scrollTop = frames_source.scrollTop;\n  });\n  frames_bundle.addEventListener('scroll', () => {\n    if (Date.now() < scroll_locked_bundle) {\n      return;\n    }\n    scroll_locked_source = Date.now() + 400;\n    frames_source.scrollTop = frames_bundle.scrollTop;\n  });\n\n  update();\n}\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJkaXN0L2dhbWUvYnVpbGQuaW50ZXJtZWRpYXRlL2NsaWVudC9jbGllbnQvYXBwLmpzIiwiZGlzdC9nYW1lL2J1aWxkLmludGVybWVkaWF0ZS9jbGllbnQvZ2xvdi9jbGllbnQvZ2xvdi9ib290c3RyYXAuanMiLCJkaXN0L2dhbWUvYnVpbGQuaW50ZXJtZWRpYXRlL2NsaWVudC9nbG92L2NsaWVudC9nbG92L2xvY2FsX3N0b3JhZ2UuanMiLCJkaXN0L2dhbWUvYnVpbGQuaW50ZXJtZWRpYXRlL2NsaWVudC9nbG92L2NsaWVudC9nbG92L3BvbHlmaWxsLmpzIiwiZGlzdC9nYW1lL2J1aWxkLmludGVybWVkaWF0ZS9jbGllbnQvY2xpZW50L21haW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7YUNJQSxJQUFJLFlBQWMsTUFDbEIsT0FBTyxPQUFTLFdBQ2QsR0FBSSxZQUFhLENBQ2YsT0FFRixZQUFjLEtBRWQsUUFBUSx1QkFDUixRQUFRLGFBQWE7Ozs7YUNQdkIsUUFBUSxpQkFFUixJQUFJLE1BQVEsU0FBUyxlQUFlLFNBQ3BDLE9BQU8sUUFBVSxTQUFVLEVBQUcsS0FBTSxLQUFNLElBQUssVUFDN0MsSUFBSSxJQUFTLEVBQVQsVUFBb0IsS0FBcEIsSUFBNEIsS0FBNUIsSUFBb0MsSUFBcEMsSUFDSixHQUFJLFVBQVksU0FBUyxNQUFPLENBQzlCLElBQUEsR0FBUyxTQUFTLE1BQ2xCLEdBQUksU0FBUyxRQUFTLENBQ3BCLEdBQUksSUFBSSxRQUFRLFNBQVMsWUFBYyxFQUFHLENBQ3hDLElBQVMsU0FBUyxRQUFsQixLQUE4QixLQUdsQyxJQUFJLE9BQVMsU0FBUyxTQUFTLFFBQVUsR0FDekMsR0FBSSxPQUFRLENBQ1YsR0FBSSxPQUFPLE9BQU8sS0FBTyxJQUFLLENBQzVCLFFBQVUsSUFFWixJQUFNLElBQUksTUFBTSxRQUFRLEtBQUssSUFHL0IsSUFBTSxJQUFJLFFBQVEs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QixNQUFPLEdBQ1AsY0FBYyxZQUFjLGtDQUM1QixNQUFNLEVBRVIsR0FBSSxnQkFBa0IsZUFBZSxVQUFZLEVBQUcsQ0FDbEQsY0FBYyxZQUFjLDJCQUM1QixZQUFjLGFBQWEsb0JBRXRCLENBQ0wsY0FBYyxZQUFjLHdEQUU5QixVQUdGLE9BQU8sV0FBVyxhQUFjLFdBR2xDLFNBQVMsY0FBYyxJQUNyQixXQUFhLEdBQUcsT0FBTyxNQUN2QixjQUFjLElBQUksUUFBUyxZQUMzQixTQUVGLE1BQU0saUJBQWlCLFNBQVUsZUFDakMsTUFBTSxpQkFBaUIsUUFBUyxlQUNoQyxNQUFNLE1BQVEsV0FBYSxjQUFjLElBQUksVUFBWSxHQUV6RCxTQUFTLGVBQWUsSUFDdEIsSUFBSSxJQUFNLEdBQUcsT0FBTyxjQUNwQixHQUFJLGNBQWMsZ0JBQWtCLElBQUssQ0FDdkMsY0FBYyxjQUFnQixJQUVoQyxHQUFJLGNBQWMsZ0JBQWtCLElBQUssQ0FDdkMsY0FBYyxjQUFnQixJQUVoQyxjQUVGLGNBQWMsaUJBQWlCLFNBQVUsZ0JBRXpDLGNBQWMsaUJBQWlCLFNBQVUsZ0JBSXpDLEdBQUksZ0JBQWtCLGVBQWUsVUFBWSxFQUFHLENBQ2xELGNBQWMsWUFBYyw4Q0FJOUIsSUFBSSxxQkFBdUIsRUFDM0IsSUFBSSxxQkFBdUIsRUFDM0IsY0FBYyxpQkFBaUIsU0FBVSxXQUN2QyxHQUFJLEtBQUssTUFBUSxxQkFBc0IsQ0FDckMsT0FFRixxQkFBdUIsS0FBSyxNQUFRLElBQ3BDLGNBQWMsVUFBWSxjQUFjLFlBRTFDLGNBQWMsaUJBQWlCLFNBQVUsV0FDdkMsR0FBSSxLQUFLLE1BQVEscUJBQXNCLENBQ3JDLE9BRUYscUJBQXVCLEtBQUssTUFBUSxJQUNwQyxjQUFjLFVBQVksY0FBYyxZQUcxQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsIi8qIGVzbGludCBnbG9iYWwtcmVxdWlyZTpvZmYgKi9cblxuLy8gU3RhcnR1cCBjb2RlLlxuXG5sZXQgY2FsbGVkX29uY2UgPSBmYWxzZTtcbndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gIGlmIChjYWxsZWRfb25jZSkge1xuICAgIHJldHVybjtcbiAgfVxuICBjYWxsZWRfb25jZSA9IHRydWU7XG4gIC8vIHJlcXVpcmUoJy4vZ2xvdi93b3JrZXJfY29tbS5qcycpLnN0YXJ0dXAoKTsgLy8gRmlyc3QsIHNvIGl0IGdldHMgbG9hZGluZyBxdWlja2x5IChpZiB3b3JrZXJzIHJlcXVpcmVkKVxuICByZXF1aXJlKCcuL2dsb3YvYm9vdHN0cmFwLmpzJyk7XG4gIHJlcXVpcmUoJy4vbWFpbi5qcycpLm1haW4oKTtcbn07XG4iLCIvLyBQb3J0aW9ucyBDb3B5cmlnaHQgMjAxOSBKaW1iIEVzc2VyIChodHRwczovL2dpdGh1Yi5jb20vSmltYmx5Lylcbi8vIFJlbGVhc2VkIHVuZGVyIE1JVCBMaWNlbnNlOiBodHRwczovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL01JVFxuXG4vLyBUaGluZ3MgdGhhdCBzaG91bGQgYmUgZG9uZSBiZWZvcmUgcmVxdWlyaW5nIG9yIHJ1bm5pbmcgYW55IHVzZXItbGV2ZWwgY29kZSBvciBvdGhlciBlbmdpbmUgY29kZVxuXG5yZXF1aXJlKCcuL3BvbHlmaWxsLmpzJyk7XG5cbmxldCBkZWJ1ZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZWJ1ZycpO1xud2luZG93Lm9uZXJyb3IgPSBmdW5jdGlvbiAoZSwgZmlsZSwgbGluZSwgY29sLCBlcnJvcm9iaikge1xuICBsZXQgbXNnID0gYCR7ZX1cXG4gIGF0ICR7ZmlsZX0oJHtsaW5lfToke2NvbH0pYDtcbiAgaWYgKGVycm9yb2JqICYmIGVycm9yb2JqLnN0YWNrKSB7XG4gICAgbXNnID0gYCR7ZXJyb3JvYmouc3RhY2t9YDtcbiAgICBpZiAoZXJyb3JvYmoubWVzc2FnZSkge1xuICAgICAgaWYgKG1zZy5pbmRleE9mKGVycm9yb2JqLm1lc3NhZ2UpID09PSAtMSkge1xuICAgICAgICBtc2cgPSBgJHtlcnJvcm9iai5tZXNzYWdlfVxcbiR7bXNnfWA7XG4gICAgICB9XG4gICAgfVxuICAgIGxldCBvcmlnaW4gPSBkb2N1bWVudC5sb2NhdGlvbi5vcmlnaW4gfHwgJyc7XG4gICAgaWYgKG9yaWdpbikge1xuICAgICAgaWYgKG9yaWdpbi5zbGljZSgtMSkgIT09ICcvJykge1xuICAgICAgICBvcmlnaW4gKz0gJy8nO1xuICAgICAgfVxuICAgICAgbXNnID0gbXNnLnNwbGl0KG9yaWdpbikuam9pbignJyk7IC8vIHJlcGxhY2VcbiAgICB9XG4gICAgLy8gZml4dXAgd2VpcmQgRmlyZWZveCB3ZWlyZG5lc3NcbiAgICBtc2cgPSBtc2cucmVwbGFjZSgvXFxbXFxkK1xcXTwvZywgJycpIC8vIHJlbW92ZSBmdW5ueSBbMTIzXSBhdCBzdGFydCBvZiBzdGFjayBsaW5lc1xuICAgICAgLnJlcGxhY2UoLzw/XFwvPD8vZywgJy8nKSAvLyByZW1vdmUgZnVubnkgPHMsIHRoZXkgbWVzcyB1cCBwZW9wbGUncyBjb3B5IGFuZCBwYXN0ZVxuICAgICAgLnJlcGxhY2UoL1xcbihbXiBdKS9nLCAnXFxuICAkMScpOyAvLyBhZGQgaW5kZW50YXRpb24gaWYgbWlzc2luZ1xuICB9XG4gIGxldCBzaG93ID0gdHJ1ZTtcbiAgaWYgKHdpbmRvdy5nbG92X2Vycm9yX3JlcG9ydCkge1xuICAgIHNob3cgPSB3aW5kb3cuZ2xvdl9lcnJvcl9yZXBvcnQobXNnLCBmaWxlLCBsaW5lLCBjb2wpO1xuICB9XG4gIGlmIChzaG93KSB7XG4gICAgZGVidWcuaW5uZXJUZXh0ID0gYCR7bXNnfVxcblxcblBsZWFzZSByZXBvcnQgdGhpcyBlcnJvciB0byB0aGUgZGV2ZWxvcGVyLCBhbmQgdGhlbiByZWxvYWQgdGhpcyBwYWdlLmA7XG4gIH1cbn07XG53aW5kb3cuZGVidWdtc2cgPSBmdW5jdGlvbiAobXNnLCBjbGVhcikge1xuICBpZiAoY2xlYXIpIHtcbiAgICBkZWJ1Zy5pbm5lclRleHQgPSBtc2c7XG4gIH0gZWxzZSB7XG4gICAgZGVidWcuaW5uZXJUZXh0ICs9IGAke21zZ31cXG5gO1xuICB9XG59O1xuIiwiLy8gUG9ydGlvbnMgQ29weXJpZ2h0IDIwMTkgSmltYiBFc3NlciAoaHR0cHM6Ly9naXRodWIuY29tL0ppbWJseS8pXG4vLyBSZWxlYXNlZCB1bmRlciBNSVQgTGljZW5zZTogaHR0cHM6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVRcbi8qIGVzbGludC1lbnYgYnJvd3NlciAqL1xuXG5leHBvcnRzLnN0b3JhZ2VfcHJlZml4ID0gJ2RlbW8nO1xuXG5sZXQgbHNkID0gKGZ1bmN0aW9uICgpIHtcbiAgdHJ5IHtcbiAgICBsb2NhbFN0b3JhZ2UudGVzdCA9ICd0ZXN0JztcbiAgICByZXR1cm4gbG9jYWxTdG9yYWdlO1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIHt9O1xuICB9XG59KCkpO1xuZXhwb3J0IGZ1bmN0aW9uIGdldChrZXkpIHtcbiAga2V5ID0gYCR7ZXhwb3J0cy5zdG9yYWdlX3ByZWZpeH1fJHtrZXl9YDtcbiAgbGV0IHJldCA9IGxzZFtrZXldO1xuICBpZiAocmV0ID09PSAndW5kZWZpbmVkJykge1xuICAgIHJldCA9IHVuZGVmaW5lZDtcbiAgfVxuICByZXR1cm4gcmV0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0KGtleSwgdmFsdWUpIHtcbiAga2V5ID0gYCR7ZXhwb3J0cy5zdG9yYWdlX3ByZWZpeH1fJHtrZXl9YDtcbiAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGwpIHtcbiAgICBkZWxldGUgbHNkW2tleV07XG4gIH0gZWxzZSB7XG4gICAgbHNkW2tleV0gPSB2YWx1ZTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0SlNPTihrZXksIHZhbHVlKSB7XG4gIHNldChrZXksIEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRKU09OKGtleSwgZGVmKSB7XG4gIGxldCB2YWx1ZSA9IGdldChrZXkpO1xuICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiBkZWY7XG4gIH1cbiAgdHJ5IHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZSh2YWx1ZSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICAvLyBpZ25vcmVcbiAgfVxuICByZXR1cm4gZGVmO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJBbGwoa2V5X3ByZWZpeCkge1xuICBsZXQgcHJlZml4ID0gbmV3IFJlZ0V4cChgXiR7ZXhwb3J0cy5zdG9yYWdlX3ByZWZpeH1fJHtrZXlfcHJlZml4IHx8ICcnfWAsICd1Jyk7XG4gIGZvciAobGV0IGtleSBpbiBsc2QpIHtcbiAgICBpZiAoa2V5Lm1hdGNoKHByZWZpeCkpIHtcbiAgICAgIGRlbGV0ZSBsc2Rba2V5XTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGV4cG9ydEFsbCgpIHtcbiAgbGV0IG9iaiA9IHt9O1xuICBsZXQgcHJlZml4ID0gbmV3IFJlZ0V4cChgXiR7ZXhwb3J0cy5zdG9yYWdlX3ByZWZpeH1fKC4qKWAsICd1Jyk7XG4gIGZvciAobGV0IGtleSBpbiBsc2QpIHtcbiAgICBsZXQgbSA9IGtleS5tYXRjaChwcmVmaXgpO1xuICAgIGlmIChtKSB7XG4gICAgICBsZXQgdiA9IGxzZFtrZXldO1xuICAgICAgaWYgKHYgJiYgdiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgb2JqW21bMV1dID0gdjtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iaik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbXBvcnRBbGwoc2VyaWFsaXplZCkge1xuICBsZXQgb2JqID0gSlNPTi5wYXJzZShzZXJpYWxpemVkKTtcbiAgY2xlYXJBbGwoKTtcbiAgZm9yIChsZXQga2V5IGluIG9iaikge1xuICAgIHNldChrZXksIG9ialtrZXldKTtcbiAgfVxufVxuIiwiLyogZXNsaW50IG5vLWV4dGVuZC1uYXRpdmU6b2ZmLG5vLWludmFsaWQtdGhpczpvZmYgKi9cblxuLy8gVHlwZWRBcnJheS5zbGljZSwgZmlsbCwgam9pbiwgc29ydCwgZXRjIC0gbm90IHN1cHBvcnRlZCBvbiBJRSwgc29tZSBvbGRlciBTYWZhcmksIG9sZGVyIEFuZHJvaWRcbmxldCB0eXBlZGFycmF5cyA9IFtJbnQ4QXJyYXksIFVpbnQ4QXJyYXksIEludDE2QXJyYXksIFVpbnQxNkFycmF5LCBJbnQzMkFycmF5LCBVaW50MzJBcnJheSwgRmxvYXQzMkFycmF5XTtcblxuaWYgKCFVaW50OEFycmF5LnByb3RvdHlwZS5zbGljZSkge1xuICB0eXBlZGFycmF5cy5mb3JFYWNoKGZ1bmN0aW9uIChBcnJheVR5cGUpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXlUeXBlLnByb3RvdHlwZSwgJ3NsaWNlJywge1xuICAgICAgdmFsdWU6IGZ1bmN0aW9uIChiZWdpbiwgZW5kKSB7XG4gICAgICAgIGlmIChlbmQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGVuZCA9IHRoaXMubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlbmQgPCAwKSB7XG4gICAgICAgICAgZW5kID0gdGhpcy5sZW5ndGggLSBlbmQ7XG4gICAgICAgIH1cbiAgICAgICAgYmVnaW4gPSBiZWdpbiB8fCAwO1xuICAgICAgICBpZiAoYmVnaW4gPj0gdGhpcy5sZW5ndGgpIHtcbiAgICAgICAgICBiZWdpbiA9IHRoaXMubGVuZ3RoIC0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZW5kID4gdGhpcy5sZW5ndGgpIHtcbiAgICAgICAgICBlbmQgPSB0aGlzLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZW5kIDwgYmVnaW4pIHtcbiAgICAgICAgICBlbmQgPSBiZWdpbjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgbGVuID0gZW5kIC0gYmVnaW47XG4gICAgICAgIGxldCByZXQgPSBuZXcgQXJyYXlUeXBlKGxlbik7XG4gICAgICAgIGZvciAobGV0IGlpID0gYmVnaW47IGlpIDwgZW5kOyArK2lpKSB7XG4gICAgICAgICAgcmV0W2lpXSA9IHRoaXNbaWldO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXQ7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjbXBEZWZhdWx0KGEsIGIpIHtcbiAgcmV0dXJuIGEgLSBiO1xufVxubGV0IHJlcGxhY2VtZW50cyA9IHtcbiAgam9pbjogZnVuY3Rpb24gKGRlbGltKSB7XG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5qb2luLmNhbGwodGhpcywgZGVsaW0pO1xuICB9LFxuICBmaWxsOiBmdW5jdGlvbiAodmFsdWUsIGJlZ2luLCBlbmQpIHtcbiAgICBpZiAoZW5kID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGVuZCA9IHRoaXMubGVuZ3RoO1xuICAgIH1cbiAgICBmb3IgKGxldCBpaSA9IGJlZ2luIHx8IDA7IGlpIDwgZW5kOyArK2lpKSB7XG4gICAgICB0aGlzW2lpXSA9IHZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgc29ydDogZnVuY3Rpb24gKGNtcCkge1xuICAgIEFycmF5LnByb3RvdHlwZS5zb3J0LmNhbGwodGhpcywgY21wIHx8IGNtcERlZmF1bHQpO1xuICB9LFxufTtcblxuZm9yIChsZXQga2V5IGluIHJlcGxhY2VtZW50cykge1xuICBpZiAoIVVpbnQ4QXJyYXkucHJvdG90eXBlW2tleV0pIHtcbiAgICB0eXBlZGFycmF5cy5mb3JFYWNoKGZ1bmN0aW9uIChBcnJheVR5cGUpIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBcnJheVR5cGUucHJvdG90eXBlLCBrZXksIHtcbiAgICAgICAgdmFsdWU6IHJlcGxhY2VtZW50c1trZXldLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbn1cblxuaWYgKCFTdHJpbmcucHJvdG90eXBlLmVuZHNXaXRoKSB7XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmcucHJvdG90eXBlLCAnZW5kc1dpdGgnLCB7XG4gICAgdmFsdWU6IGZ1bmN0aW9uICh0ZXN0KSB7XG4gICAgICByZXR1cm4gdGhpcy5zbGljZSgtdGVzdC5sZW5ndGgpID09PSB0ZXN0O1xuICAgIH0sXG4gIH0pO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU3RyaW5nLnByb3RvdHlwZSwgJ3N0YXJ0c1dpdGgnLCB7XG4gICAgdmFsdWU6IGZ1bmN0aW9uICh0ZXN0KSB7XG4gICAgICByZXR1cm4gdGhpcy5zbGljZSgwLCB0ZXN0Lmxlbmd0aCkgPT09IHRlc3Q7XG4gICAgfSxcbiAgfSk7XG59XG4iLCIvKiBlc2xpbnQgbm8tdXNlbGVzcy1jYXRjaDpvZmYgKi9cbmNvbnN0IGxvY2FsX3N0b3JhZ2UgPSByZXF1aXJlKCcuL2dsb3YvbG9jYWxfc3RvcmFnZS5qcycpO1xubG9jYWxfc3RvcmFnZS5zdG9yYWdlX3ByZWZpeCA9ICdzdGFja3dhbGtlcic7XG5cbmNvbnN0IHF1ZXJ5c3RyaW5nID0gcmVxdWlyZSgncXVlcnktc3RyaW5nJyk7XG5jb25zdCBzdGFja19tYXBwZXIgPSByZXF1aXJlKCdzdGFjay1tYXBwZXInKTtcblxubGV0IGVycm9yX3JlcG9ydF9yZWdleCA9IC9eKFteIF0rKSBcXFsoW15cXF1dKyldIFwiUE9TVCAoW15cIj9dKyk/KFteXCJdKylcIiBTVEFSVCBcIihbXlwiXSspXCIgXCIoW15cIl0rKVwiJC87XG5sZXQgZmlsZWxpbmVfcmVnZXgxID0gLyguKShbXigvOl0rKVxcKChcXGQrKTooXFxkKylcXCkkLztcbmxldCBmaWxlbGluZV9yZWdleDIgPSAvKD86YXQgKFteKF0rKSBcXCguKlxcLyk/KFteKC86XSspOihcXGQrKSg/OjooXFxkKykpP1xcKSQvO1xuXG5mdW5jdGlvbiBwcmV0dHlGaWxlTGluZShhKSB7XG4gIHJldHVybiBgJHthLmZuIHx8ICcnfSAoJHthLmZpbGVuYW1lfToke2EubGluZX06JHthLmNvbHVtbn0pYDtcbn1cblxuZnVuY3Rpb24gcHJlcGFyc2UodGV4dCkge1xuICBsZXQgbGluZXMgPSB0ZXh0LnNwbGl0KCdcXG4nKTtcbiAgbGV0IHJldCA9IFtdO1xuICBmb3IgKGxldCBpaSA9IDA7IGlpIDwgbGluZXMubGVuZ3RoOyArK2lpKSB7XG4gICAgbGV0IGxpbmUgPSBsaW5lc1tpaV07XG4gICAgbGV0IG0gPSBsaW5lLm1hdGNoKGVycm9yX3JlcG9ydF9yZWdleCk7XG4gICAgaWYgKCFtKSB7XG4gICAgICByZXQucHVzaChsaW5lKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICAvLyBsZXQgaXAgPSBtWzFdO1xuICAgIC8vIGxldCB0aW1lc3RhbXAgPSBtWzJdO1xuICAgIC8vIGxldCB1cmxfc3RhcnQgPSBtWzNdO1xuICAgIGxldCBzZWFyY2ggPSBtWzRdO1xuICAgIC8vIGxldCByZWZlcnJlciA9IG1bNV07XG4gICAgbGV0IHVzZXJhZ2VudCA9IG1bNl07XG4gICAgbGV0IHF1ZXJ5ID0gcXVlcnlzdHJpbmcucGFyc2Uoc2VhcmNoKTtcbiAgICAvLyBTb3VyY2UgVVJMIGxpbmVcbiAgICBpZiAocXVlcnkudXJsKSB7XG4gICAgICByZXQucHVzaCgnJyk7XG4gICAgICByZXQucHVzaChgVXNlciBVUkw9JHtxdWVyeS51cmx9LCBVQT0ke3VzZXJhZ2VudH1gKTtcbiAgICB9XG4gICAgLy8gSGVhZGVyIGxpbmVcbiAgICBsZXQgaGVhZGVyID0gW107XG4gICAgaWYgKHF1ZXJ5LmNpZHggJiYgcXVlcnkuY2lkeCAhPT0gJzEnKSB7XG4gICAgICBoZWFkZXIucHVzaChgQ0lEWD0ke3F1ZXJ5LmNpZHh9YCk7XG4gICAgfVxuICAgIGlmIChxdWVyeS52ZXIpIHtcbiAgICAgIGhlYWRlci5wdXNoKGB2ZXI9JHtxdWVyeS52ZXJ9YCk7XG4gICAgfVxuICAgIGlmIChoZWFkZXIubGVuZ3RoKSB7XG4gICAgICByZXQucHVzaChoZWFkZXIuam9pbignLCAnKSk7XG4gICAgfVxuICAgIGlmIChxdWVyeS5maWxlKSB7XG4gICAgICByZXQucHVzaChwcmV0dHlGaWxlTGluZSh7XG4gICAgICAgIGZpbGVuYW1lOiBxdWVyeS5maWxlLm1hdGNoKC9bXi9dKyQvKVswXSxcbiAgICAgICAgbGluZTogcXVlcnkubGluZSxcbiAgICAgICAgY29sdW1uOiBxdWVyeS5jb2wsXG4gICAgICB9KSk7XG4gICAgfVxuICAgIHJldCA9IHJldC5jb25jYXQocXVlcnkubXNnLnNwbGl0KCdcXG4nKSk7XG4gIH1cbiAgcmV0dXJuIHJldC5qb2luKCdcXG4nKTtcbn1cblxuZnVuY3Rpb24gcGFyc2VTdGFjayh0ZXh0KSB7XG4gIHRleHQgPSBwcmVwYXJzZSh0ZXh0KTtcbiAgbGV0IGxpbmVzID0gdGV4dC5zcGxpdCgnXFxuJyk7XG4gIGxpbmVzID0gbGluZXMubWFwKChsaW5lKSA9PiB7XG4gICAgbGV0IG0gPSBsaW5lLm1hdGNoKGZpbGVsaW5lX3JlZ2V4MSkgfHwgbGluZS5tYXRjaChmaWxlbGluZV9yZWdleDIpO1xuICAgIGlmIChtKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBmbjogbVsxXSxcbiAgICAgICAgZmlsZW5hbWU6IG1bMl0sXG4gICAgICAgIGxpbmU6IG1bM10sXG4gICAgICAgIGNvbHVtbjogbVs0XSA/IE51bWJlcihtWzRdKSAtIDEgOiB1bmRlZmluZWQsIC8vIHRoZSAtIDEgc2VlbXMgdG8gaGVscCBpbiBzb21lIGNhc2VzXG4gICAgICAgIHRvb2x0aXA6IGxpbmUsXG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4geyBlcnI6IGxpbmUsIHRvb2x0aXA6IGxpbmUgfTtcbiAgfSk7XG4gIHJldHVybiBsaW5lcztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1haW4oKSB7XG4gIGxldCB1cGxvYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXBsb2FkJyk7XG4gIGxldCB1cGxvYWRfc3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VwbG9hZF9zdGF0dXMnKTtcbiAgbGV0IHN0YWNrID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YWNrJyk7XG4gIGxldCBmcmFtZXNfYnVuZGxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZyYW1lc19idW5kbGUnKTtcbiAgbGV0IGZyYW1lc19zb3VyY2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZnJhbWVzX3NvdXJjZScpO1xuICBsZXQgc291cmNlY29kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3VyY2Vjb2RlJyk7XG4gIGxldCBzb3VyY2VfcHJlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvdXJjZV9wcmUnKTtcbiAgbGV0IHNvdXJjZV9saW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvdXJjZV9saW5lJyk7XG4gIGxldCBzb3VyY2VfcG9zdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3VyY2VfcG9zdCcpO1xuXG4gIGxldCBzdGFja19kYXRhO1xuICBsZXQgc291cmNlbWFwX2RhdGE7XG4gIGxldCBzdGFja21hcHBlcjtcblxuICBmdW5jdGlvbiB0b09wdGlvbnMobGlzdCkge1xuICAgIHJldHVybiBsaXN0Lm1hcCgoYSkgPT4ge1xuICAgICAgbGV0IHN0ciA9IGEuZXJyICE9PSB1bmRlZmluZWQgPyBhLmVyciA6IHByZXR0eUZpbGVMaW5lKGEpO1xuICAgICAgcmV0dXJuIGA8b3B0aW9uJHthLmVyciA/ICcgZGlzYWJsZWQnIDogJyd9YCArXG4gICAgICAgIGAke2EudG9vbHRpcD9gIHRpdGxlPVwiJHthLnRvb2x0aXAucmVwbGFjZSgvXCIvZywgJyZxdW90OycpfVwiYDonJ31gICtcbiAgICAgICAgYD4ke3N0cn08L29wdGlvbj5gO1xuICAgIH0pLmpvaW4oJ1xcbicpO1xuICB9XG5cbiAgbGV0IG1hcHBlZF9zdGFjaztcblxuICBmdW5jdGlvbiB1cGRhdGUoKSB7XG4gICAgLy8gd2luZG93LmRlYnVnbXNnKCcnLCB0cnVlKTtcbiAgICBsZXQgc3RhY2tfZnJhbWVzID0gcGFyc2VTdGFjayhzdGFja19kYXRhKTtcbiAgICBmcmFtZXNfYnVuZGxlLmlubmVySFRNTCA9IHRvT3B0aW9ucyhzdGFja19mcmFtZXMpO1xuXG4gICAgbWFwcGVkX3N0YWNrID0gbnVsbDtcbiAgICBpZiAoIXN0YWNrbWFwcGVyKSB7XG4gICAgICBmcmFtZXNfc291cmNlLmlubmVySFRNTCA9IHRvT3B0aW9ucyhbeyBlcnI6ICdNaXNzaW5nIHNvdXJjZW1hcCcgfV0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgbGluZV9tYXBwaW5nID0ge307XG4gICAgbGV0IHRvX3Byb2Nlc3MgPSBbXTtcbiAgICBmb3IgKGxldCBpaSA9IDA7IGlpIDwgc3RhY2tfZnJhbWVzLmxlbmd0aDsgKytpaSkge1xuICAgICAgbGV0IGVsZW0gPSBzdGFja19mcmFtZXNbaWldO1xuICAgICAgaWYgKGVsZW0uZmlsZW5hbWUpIHtcbiAgICAgICAgbGluZV9tYXBwaW5nW2lpXSA9IHRvX3Byb2Nlc3MubGVuZ3RoO1xuICAgICAgICB0b19wcm9jZXNzLnB1c2goZWxlbSk7XG4gICAgICB9XG4gICAgfVxuICAgIGxldCBvdXQgPSBzdGFja21hcHBlci5tYXAodG9fcHJvY2Vzcyk7XG4gICAgbGV0IG91dF9saW5lcyA9IFtdO1xuICAgIG1hcHBlZF9zdGFjayA9IFtdO1xuICAgIGZvciAobGV0IGlpID0gMDsgaWkgPCBzdGFja19mcmFtZXMubGVuZ3RoOyArK2lpKSB7XG4gICAgICBpZiAobGluZV9tYXBwaW5nW2lpXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG1hcHBlZF9zdGFjay5wdXNoKG51bGwpO1xuICAgICAgICBvdXRfbGluZXMucHVzaCh7IGVycjogJycgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtYXBwZWRfc3RhY2sucHVzaChvdXRbbGluZV9tYXBwaW5nW2lpXV0pO1xuICAgICAgICBvdXRfbGluZXMucHVzaChvdXRbbGluZV9tYXBwaW5nW2lpXV0pO1xuICAgICAgfVxuICAgIH1cbiAgICBmcmFtZXNfc291cmNlLmlubmVySFRNTCA9IHRvT3B0aW9ucyhvdXRfbGluZXMpO1xuICB9XG5cbiAgZnVuY3Rpb24gdXBkYXRlRm9jdXMoKSB7XG4gICAgbGV0IGlkeCA9IGZyYW1lc19idW5kbGUuc2VsZWN0ZWRJbmRleDtcbiAgICBsZXQgbGluZWluZm8gPSBtYXBwZWRfc3RhY2sgJiYgbWFwcGVkX3N0YWNrW2lkeF07XG4gICAgaWYgKCFzb3VyY2VtYXBfZGF0YSkge1xuICAgICAgc291cmNlX3ByZS50ZXh0Q29udGVudCA9ICdObyBzb3VyY2VtYXAgbG9hZGVkJztcbiAgICAgIHNvdXJjZV9saW5lLnRleHRDb250ZW50ID0gc291cmNlX3Bvc3QudGV4dENvbnRlbnQgPSAnJztcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFsaW5laW5mbykge1xuICAgICAgc291cmNlX3ByZS50ZXh0Q29udGVudCA9ICdObyBzb3VyY2Ugc2VsZWN0ZWQnO1xuICAgICAgc291cmNlX2xpbmUudGV4dENvbnRlbnQgPSBzb3VyY2VfcG9zdC50ZXh0Q29udGVudCA9ICcnO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgeyBzb3VyY2VzLCBzb3VyY2VzQ29udGVudCB9ID0gc291cmNlbWFwX2RhdGE7XG4gICAgbGV0IHsgZmlsZW5hbWUsIGxpbmUgfSA9IGxpbmVpbmZvO1xuICAgIGxldCBmb3VuZCA9IC0xO1xuICAgIGZvciAobGV0IGlpID0gMDsgaWkgPCBzb3VyY2VzLmxlbmd0aDsgKytpaSkge1xuICAgICAgaWYgKHNvdXJjZXNbaWldLmVuZHNXaXRoKGZpbGVuYW1lKSkge1xuICAgICAgICBmb3VuZCA9IGlpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoZm91bmQgPT09IC0xIHx8ICFzb3VyY2VzQ29udGVudFtmb3VuZF0pIHtcbiAgICAgIHNvdXJjZV9wcmUudGV4dENvbnRlbnQgPSBgQ291bGQgbm90IGZpbmQgJHtmaWxlbmFtZX0gaW4gc291cmNlbWFwLnNvdXJjZXNgO1xuICAgICAgc291cmNlX2xpbmUudGV4dENvbnRlbnQgPSBzb3VyY2VfcG9zdC50ZXh0Q29udGVudCA9ICcnO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgbGluZXMgPSBzb3VyY2VzQ29udGVudFtmb3VuZF0uc3BsaXQoJ1xcbicpO1xuICAgIHNvdXJjZV9wcmUudGV4dENvbnRlbnQgPSBsaW5lcy5zbGljZSgwLCBsaW5lIC0gMSkuam9pbignXFxuJyk7XG4gICAgc291cmNlX2xpbmUudGV4dENvbnRlbnQgPSBsaW5lc1tsaW5lIC0gMV07XG4gICAgc291cmNlX3Bvc3QudGV4dENvbnRlbnQgPSBsaW5lcy5zbGljZShsaW5lLCBsaW5lcy5sZW5ndGgpLmpvaW4oJ1xcbicpO1xuICAgIHNvdXJjZV9saW5lLnNjcm9sbEludG9WaWV3KHRydWUpO1xuICAgIGxldCBzdCA9IHNvdXJjZWNvZGUuc2Nyb2xsVG9wO1xuICAgIHNvdXJjZV9saW5lLnNjcm9sbEludG9WaWV3KGZhbHNlKTtcbiAgICBzdCArPSBzb3VyY2Vjb2RlLnNjcm9sbFRvcDtcbiAgICBzb3VyY2Vjb2RlLnNjcm9sbFRvcCA9IE1hdGgucm91bmQoc3QgLyAyKTtcbiAgfVxuXG4gIHVwbG9hZC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZXYpID0+IHtcbiAgICBsZXQgZmlsZV90b19sb2FkID0gdXBsb2FkLmZpbGVzWzBdO1xuICAgIGxldCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgIGxvY2FsX3N0b3JhZ2Uuc2V0KCdzb3VyY2VtYXAnLCB1bmRlZmluZWQpO1xuICAgIHNvdXJjZW1hcF9kYXRhID0gbnVsbDtcbiAgICBzdGFja21hcHBlciA9IG51bGw7XG4gICAgcmVhZGVyLm9ubG9hZCA9IChsb2FkZWRfZXZlbnQpID0+IHtcbiAgICAgIGxldCB0ZXh0ID0gbG9hZGVkX2V2ZW50LnRhcmdldC5yZXN1bHQ7XG4gICAgICB0cnkge1xuICAgICAgICBzb3VyY2VtYXBfZGF0YSA9IEpTT04ucGFyc2UodGV4dCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHVwbG9hZF9zdGF0dXMudGV4dENvbnRlbnQgPSAnU3RhdHVzOiBFcnJvciBwYXJzaW5nIFNvdXJjZW1hcCc7XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9XG4gICAgICBpZiAoc291cmNlbWFwX2RhdGEgJiYgc291cmNlbWFwX2RhdGEudmVyc2lvbiA9PT0gMykge1xuICAgICAgICB1cGxvYWRfc3RhdHVzLnRleHRDb250ZW50ID0gJ1N0YXR1czogU291cmNlbWFwIGxvYWRlZCc7XG4gICAgICAgIHN0YWNrbWFwcGVyID0gc3RhY2tfbWFwcGVyKHNvdXJjZW1hcF9kYXRhKTtcbiAgICAgICAgLy9sb2NhbF9zdG9yYWdlLnNldEpTT04oJ3NvdXJjZW1hcCcsIHNvdXJjZW1hcF9kYXRhKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHVwbG9hZF9zdGF0dXMudGV4dENvbnRlbnQgPSAnU3RhdHVzOiBFcnJvciBwYXJzaW5nIFNvdXJjZW1hcCAoZXhwZWN0ZWQgdmVyc2lvbjogMyknO1xuICAgICAgfVxuICAgICAgdXBkYXRlKCk7XG4gICAgfTtcblxuICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGVfdG9fbG9hZCwgJ1VURi04Jyk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIG9uU3RhY2tDaGFuZ2UoZXYpIHtcbiAgICBzdGFja19kYXRhID0gZXYudGFyZ2V0LnZhbHVlO1xuICAgIGxvY2FsX3N0b3JhZ2Uuc2V0KCdzdGFjaycsIHN0YWNrX2RhdGEpO1xuICAgIHVwZGF0ZSgpO1xuICB9XG4gIHN0YWNrLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uU3RhY2tDaGFuZ2UpO1xuICBzdGFjay5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uU3RhY2tDaGFuZ2UpO1xuICBzdGFjay52YWx1ZSA9IHN0YWNrX2RhdGEgPSBsb2NhbF9zdG9yYWdlLmdldCgnc3RhY2snKSB8fCAnJztcblxuICBmdW5jdGlvbiBvbkZyYW1lc0NoYW5nZShldikge1xuICAgIGxldCBpZHggPSBldi50YXJnZXQuc2VsZWN0ZWRJbmRleDtcbiAgICBpZiAoZnJhbWVzX2J1bmRsZS5zZWxlY3RlZEluZGV4ICE9PSBpZHgpIHtcbiAgICAgIGZyYW1lc19idW5kbGUuc2VsZWN0ZWRJbmRleCA9IGlkeDtcbiAgICB9XG4gICAgaWYgKGZyYW1lc19zb3VyY2Uuc2VsZWN0ZWRJbmRleCAhPT0gaWR4KSB7XG4gICAgICBmcmFtZXNfc291cmNlLnNlbGVjdGVkSW5kZXggPSBpZHg7XG4gICAgfVxuICAgIHVwZGF0ZUZvY3VzKCk7XG4gIH1cbiAgZnJhbWVzX2J1bmRsZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZyYW1lc0NoYW5nZSk7XG4gIC8vZnJhbWVzX2J1bmRsZS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uRnJhbWVzQ2hhbmdlKTtcbiAgZnJhbWVzX3NvdXJjZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZyYW1lc0NoYW5nZSk7XG4gIC8vZnJhbWVzX3NvdXJjZS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uRnJhbWVzQ2hhbmdlKTtcblxuICAvL3NvdXJjZW1hcF9kYXRhID0gbG9jYWxfc3RvcmFnZS5nZXRKU09OKCdzb3VyY2VtYXAnKTtcbiAgaWYgKHNvdXJjZW1hcF9kYXRhICYmIHNvdXJjZW1hcF9kYXRhLnZlcnNpb24gPT09IDMpIHtcbiAgICB1cGxvYWRfc3RhdHVzLnRleHRDb250ZW50ID0gJ1N0YXR1czogU291cmNlbWFwIGxvYWRlZCBmcm9tIGxvY2FsIHN0b3JhZ2UnO1xuICB9XG5cbiAgLy8gU3luYyBzY3JvbGwgYXJlYXNcbiAgbGV0IHNjcm9sbF9sb2NrZWRfc291cmNlID0gMDtcbiAgbGV0IHNjcm9sbF9sb2NrZWRfYnVuZGxlID0gMDtcbiAgZnJhbWVzX3NvdXJjZS5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCAoKSA9PiB7XG4gICAgaWYgKERhdGUubm93KCkgPCBzY3JvbGxfbG9ja2VkX3NvdXJjZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzY3JvbGxfbG9ja2VkX2J1bmRsZSA9IERhdGUubm93KCkgKyA0MDA7XG4gICAgZnJhbWVzX2J1bmRsZS5zY3JvbGxUb3AgPSBmcmFtZXNfc291cmNlLnNjcm9sbFRvcDtcbiAgfSk7XG4gIGZyYW1lc19idW5kbGUuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgKCkgPT4ge1xuICAgIGlmIChEYXRlLm5vdygpIDwgc2Nyb2xsX2xvY2tlZF9idW5kbGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc2Nyb2xsX2xvY2tlZF9zb3VyY2UgPSBEYXRlLm5vdygpICsgNDAwO1xuICAgIGZyYW1lc19zb3VyY2Uuc2Nyb2xsVG9wID0gZnJhbWVzX2J1bmRsZS5zY3JvbGxUb3A7XG4gIH0pO1xuXG4gIHVwZGF0ZSgpO1xufVxuIl19"}